---
title: "ShinyPsych - Tutorials"
author: "Markus Steiner, Nathaniel Phillips"
date: "22 August 2017"
output:
  html_document:
    highlight: haddock
    theme: lumen
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## About ShinyPsych

### General

ShinyPsych is an R package designed to help implementing experiments in shiny apps. If you don't know about shiny yet, we recommend checking out the [shiny webpage](https://shiny.rstudio.com/) which contains many great tutorials and explanations on what shiny is and how to build apps. Shiny apps are, in their usual form, not suitable to implement experiments and surveys because they are designed to dynamically display information on one page, possibly with some page navigation by using different panels. In an experiment or survey, however, one typically wants to display items on different pages to which the participant can not switch back and forth but has to follow a predefined order of pages. These tutorials show you how to do this and how to use different functions implemented in ShinyPsych, designed to facilitate programming an experiment. Although we tried to simplify programming the app, you still need to now how to work with R. If you have no experience of using R you best go through some tutorials (e.g. with [YaRrr! The Pirate's Guide to R](https://bookdown.org/ndphillips/YaRrr/), a free E-book, written by Nathaniel Phillips or the [the RStudio online tutorial](https://www.rstudio.com/online-learning/#R)).  
### Structure

You'll find that every task or page created with ShinyPsych includes more or less the same steps in the code. For all these things (and others) we have functions in ShinyPsych. First you read in the appropriate css and javascript files. Then you specify the list or file from which the pages should be created or outcomes be sampled from. Thirdly, you give this file or list to a function that prepares everything to be in the correct format. When the respective page is called a function takes that list and creates the html pages that are then displayed by shiny. The last two steps are the page navigation, i.e. you set up code to control which page is displayed when and in the end save the data to dropbox or your computer. This is the general framework to set up any survey or task or combination of them with ShinyPsych.

### Performance

One important thing about R shiny is that there are some performance issues for large apps hosted online. Sometimes crashes occur. Then the user is shown a message that the connection to the server was lost and if one then clicks the refresh button one is sent back to the first page. Therefore, if you plan to run your experiment online with many participants, be sure to thoroughly test your app. Heres a [link](https://rdotgov.wordpress.com/deploy-shiny/) to an article we found on this issue, that shows that also others who have thoroughly developped apps experience this issue. We made the same experience as they did with tuning the app settings on shinyapps.io to be *not trivial* as they put it. That being said, it is possible to gather relatively large amounts of data using shiny apps. We gathered data of around 500 participants. To do this, however, we ran several batches of participants and split the experiment up in different apps linked with each other. However, some crashes still occurred.

If you want to use ShinyPsych to run experiments in the lab, we recommend running the app locally on your computer from an R session and not hosting it online. This will reduce the crashes to an absolute minimum and there will never be issues with requests having to be handled simultaneously.

## Get ShinyPsych

If you'd like to use ShinyPsych, download and load it via

```{r, eval=FALSE}
install.packages("ShinyPsych", dependencies = TRUE)
library("ShinyPsych")
```

## Saving Data to Dropbox

In all the surveys and tasks data is generated. You can save this data locally on your computer if you run the app locally. If you run it on a server an easy solution is to use dropbox to store your data. This is why we implemented the possibility the possibility to read and write data from and to dropbox in our functions. To do this we use the `rdrop2`package. To use this functionality you need to have dropbox access token saved in a file that you can give to our functions. Creating your access tokens is pretty easy, just follow this procedure:

```{r, eval=FALSE}
install.packages("rdrop2")                 # install rdrop2 packagre
droptoken <- rdrop2::drop_auth()           # Will open a browser and ask you to login
saveRDS(droptoken, file = "droptoken.rds") # Save token as droptoken.rds
```


## Create HTML Pages in ShinyPsych

ShinyPsych comes with functions to prepare and display pages containing text and some input formats available via shiny. This allows you to display instructions or let the participant answer a survey.

### Surveys and Text

Surveys are one of the most important methods of gathering informations in studies. ShinyPsych provides a way of including surveys and instructions in an app by simply giving it a text file with the survey. To learn how to format such a text file check out section *How to Create the txt Files*. [Here's a Tutorial on How to Create a Survey App](placeholder "Survey App Tutorial")

### Check Id

The function to display survey and text pages also includes the possibility of an id check, i.e. it is checked whether the id entered by the participant is already in a database of ids. This gives you the possibility to prevent participants from repeated participation. [Here's a Tutorial on How to Include an Id Check](placeholder "Id Check App")

### How to Create the txt Files

An important part of creating apps with ShinyPsych is to create the files containing the info on creating pages. You can put whole surveys in one file and use this to display the whole survey in the app. [Here's a Tutorial on How to Create these Files](placeholder "Create Files Tutorial")

## Tasks Implemented in ShinyPsych

Currently implemented in ShinyPsych are five different tasks often used in decision making research. You can find a tutorial on how to set up each task below.  
Note that all tutorials will explain the whole app without relying on other tutorials here, except the one to create pages, which would take too much space to repeat several times. If you go through several of the tutorials, you will therefore find most things covered multiple times...


### Balloon Analogue Risk Task (BART)

The bart is a behavioral measure of risk taking developped by [Lejuez et al. (2002)](https://s3.amazonaws.com/academia.edu.documents/43367762/BART.pdf?AWSAccessKeyId=AKIAIWOWYYGZ2Y53UL3A&Expires=1503483922&Signature=Ak0mwJl%2Bkf3T%2BULRzThS7NELRwU%3D&response-content-disposition=inline%3B%20filename%3DEvaluation_of_a_Behavioral_Measure_of_Ri.pdf "Link to pdf"). In the bart, participants are presented a balloon they have to pump up. With each pump it becomes more likely that the balloon will explode. The more bigger the balloon is pumped, the more money you win given that it does not explode by the last pump. You could either use a single balloon, i.e. you can still have multiple trials but only one balloon type with a specific underlying distribution, or multiple balloons with different underlying distributions. [Here's a tutorial for the Bart](placeholder "BART").

### Delay Discounting Task

#### Task Tutorial
The delay discounting (DD) task  is designed to measure a persons impulsivity/ ability to delay rewards [(see Richards, Zhan, Mitchel & de Wit, 1999)](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1284697/pdf/10220927.pdf "Link to pdf"). In DD a person is presented two outcomes, each of which he can receive after an indicated time period. The normal structure is that one is presented with a smaller outcome which he could get sooner, or a larger reward which he could get later. The person then has to indicate his preference by choosing one of the outcome-time pairs. [Here's a tutorial for the DD task](placeholder "Delay Discounting").

#### How to Create the DD Lists

In the DD task it's convenient to create a txt file with the variables and load this file into the app with the functions provided by ShinyPsych. For this to work, the file must be in a specific form. [Click here](placeholder "Create DD Files") for a short explanation with an example on how to set up the file.

### Decisions from Description Task

#### Task Tutorial

Decisions from Description (DfD) are choice problems in the form of lotteries in which participants are presented different options with oucome-probability pairs and then have to indicate their preference for an option. ShinyPsych supports two to four different options with up to six outcomes each (you could have more outcomes but then you'd need to change the css file to change the boxes size). Most studies that used these kinds of choice problems let participants choose between two options. We included some default gamble lists in ShinyPsych that are relatively often used. Sometimes the lists are contain only a subset of the gambles used in the study (e.g. Gloeckner & Pachur, 2012) or are a composition of gambles from several studies (the Birnbaum gambles). Some of the lists contain additional information you could use such as gamble types (the Brooks, Peters & Zank, 2014 list) or paradox type they belong to (the Birnbaum, 2008 list). Available default lists are gambles from [e.g. Birnbaum (2008)](http://psych.fullerton.edu/MBIRNbAUM/PSYCH466/articles/New_Paradoxes_PsyRev_2008.pdf "Link to pdf"), [Brooks, Peters and Zank (2014)](https://www.researchgate.net/profile/Simon_Peters2/publication/238597494_Risk_Behaviour_for_Gain_Loss_and_Mixed_Prospects/links/0c96052cd93c31105a000000.pdf "Link to pdf"), [Gloeckner and Pachur (2012)](https://pdfs.semanticscholar.org/6b2a/169745fddfc41186ab2425a8e2daa14232d4.pdf "Link to pdf"), [Hertwig, Barron, Weber and Erev (2004)](http://www.skidmore.edu/~hfoley/Exp.Labs/Lab%203.S06/Hertwig_2004.pdf "Link to pdf"), [Loomes, Moffatt and Sugden (2002)](http://psych.fullerton.edu/mBIRNBAUM/collaborations/Loomes_Moffatt_Sugden_JRU_2002.pdf "Link to pdf") and [Rieskamp (2008)](https://www.researchgate.net/profile/Joerg_Rieskamp/publication/23447804_The_Probabilistic_Nature_of_Preferential_Choice/links/0fcfd50e6b77c68018000000.pdf "Link to pdf").

[Here's a tutorial for the DfD Task](placeholder "Decisions from Description").

#### How to Create the Gamble Lists

In the DfD and DfE tasks it's convenient to create a txt file containing the gambles and load this file into the app with the functions provided by ShinyPsych. For this to work, the file must be in a specific form. [Click here](placeholder "Create Gamble Files") for a short explanation with an example on how to set up the file.


### Decisions from Experience Task

#### Task Tutorial

Decisions from Experience (DfE) are choice problems in the form of lotteries in which participants are presented different options with oucome-probability pairs and then have to indicate their preference for an option. In contrast to Decisions from Description however, these outcome-probability pairs are not stated explicitly (i.e. numerically), but have to be learned by the participant through sampling of the options. Each time a participant samples from an option, one of the outcome is drawn with it's associated probability and shown to the participant. One can sample as long as one wishes and then make a decision for one of the options. ShinyPsych supports two to six different options with no limit to outcomes each. Most studies that used these kinds of choice problems let participants choose between two options. We included some default gamble lists in ShinyPsych that are relatively often used. Sometimes the lists are contain only a subset of the gambles used in the study (e.g. Gloeckner & Pachur, 2012) or are a composition of gambles from several studies (the Birnbaum gambles). Some of the lists contain additional information you could use such as gamble types (the Brooks, Peters & Zank, 2014 list) or paradox type they belong to (the Birnbaum, 2008 list). Available default lists are gambles from [e.g. Birnbaum (2008)](http://psych.fullerton.edu/MBIRNbAUM/PSYCH466/articles/New_Paradoxes_PsyRev_2008.pdf "Link to pdf"), [Brooks, Peters and Zank (2014)](https://www.researchgate.net/profile/Simon_Peters2/publication/238597494_Risk_Behaviour_for_Gain_Loss_and_Mixed_Prospects/links/0c96052cd93c31105a000000.pdf "Link to pdf"), [Gloeckner and Pachur (2012)](https://pdfs.semanticscholar.org/6b2a/169745fddfc41186ab2425a8e2daa14232d4.pdf "Link to pdf"), [Hertwig, Barron, Weber and Erev (2004)](http://www.skidmore.edu/~hfoley/Exp.Labs/Lab%203.S06/Hertwig_2004.pdf "Link to pdf"), [Loomes, Moffatt and Sugden (2002)](http://psych.fullerton.edu/mBIRNBAUM/collaborations/Loomes_Moffatt_Sugden_JRU_2002.pdf "Link to pdf") and [Rieskamp (2008)](https://www.researchgate.net/profile/Joerg_Rieskamp/publication/23447804_The_Probabilistic_Nature_of_Preferential_Choice/links/0fcfd50e6b77c68018000000.pdf "Link to pdf").

[Here's a tutorial for the DfE Task](placeholder "Decisions from Experience").

#### How to Create the Gamble Lists

In the DfD and DfE tasks it's convenient to create a txt file containing the gambles and load this file into the app with the functions provided by ShinyPsych. For this to work, the file must be in a specific form. [Click here](placeholder "Create Gamble Files") for a short explanation with an example on how to set up the file.

### n Armed Bandit Task

The Bandit task is an often used reinforcement learning task [(Sutton & Barto, 1998)](http://people.inf.elte.hu/lorincz/Files/RL_2006/SuttonBook.pdf "Link to pdf"), in which a person has to learn about the underlying distributions of each arm, by sampling from the options. Each time a person draws a sample from an option, the sampled point value is then added to his total point value. The *n* in n Armed Bandit indicates the number of options presented. ShinyPsych supports two to six arms, each of which can have a different underlying distribution type (e.g. a three Armed Bandit with $Opt1 \sim\mathcal{N}(\mu, \sigma)$, $Opt2 \sim uniform(min, max)$ and $Opt3 \sim exgauss(\mu, \sigma, \tau)$). [Here's a tutorial for the three Armed Bandit](placeholder "n Armed Bandit").


